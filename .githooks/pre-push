#!/bin/bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ” VALIDACIÃ“N DE NOMBRE DE RAMA
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Define los patrones permitidos

# Obtiene el nombre de la rama actual
branch_name=$(git rev-parse --abbrev-ref HEAD)
# Verifica si el nombre de la rama coincide con alguno de los patrones permitidos

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“„ VALIDACIÃ“N DE DOCUMENTACIÃ“N PHPDOC
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo "ğŸ” Ejecutando validaciÃ³n PHPDoc con PHPCS..."
# Obtener archivos PHP modificados (comparando contra el Ãºltimo commit en remoto)
FILES=$(git diff --cached --name-only origin/"$branch_name" | grep -E '\.php$')
# Si no hay archivos PHP modificados, no hacemos nada
if [ -z "$FILES" ]; then
  echo "âœ… No hay archivos PHP modificados para validar."
  exit 0
fi
# Flag de errores
ERROR=0
# Verificar cada archivo PHP modificado que realmente exista
for FILE in $FILES; do
  if [ -f "$FILE" ]; then
    echo "ğŸ“‚ Validando $FILE ..."
    vendor/bin/phpcs --standard=phpcs.xml "$FILE"
    if [ $? -ne 0 ]; then
      ERROR=1
    fi
  else
    echo "âš ï¸ Archivo omitido (no existe): $FILE"
  fi
done
# Si hay errores, cancelar el push
if [ $ERROR -ne 0 ]; then
  echo "âŒ Se encontraron errores en la documentaciÃ³n PHPDoc. Corrige antes de hacer push."
  exit 1
fi
echo "âœ… ValidaciÃ³n exitosa. Continuando con el push."
exit 0