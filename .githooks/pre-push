#!/bin/sh

echo "üöÄ Iniciando validaci√≥n de documentaci√≥n en archivos modificados..."

# Detectar archivos PHP modificados respecto a origin/main
MODIFIED_FILES=$(git diff --cached --name-only origin/main -- '*.php')

if [ -z "$MODIFIED_FILES" ]; then
    echo "‚úÖ No se detectaron archivos PHP modificados para validar."
    exit 0
fi

echo "üìÑ Archivos modificados detectados:"
echo "$MODIFIED_FILES"

# Recorrer cada archivo modificado y validarlo con el script doc-validator.php
for file in $MODIFIED_FILES; do
    echo ""
    echo "‚û°Ô∏è Validando $file..."
    php scripts/doc-validator.php "$file"
    VALID_EXIT_CODE=$?
    if [ $VALID_EXIT_CODE -ne 0 ]; then
        echo "‚ùå Errores de documentaci√≥n detectados en $file. Corrige antes de hacer push."
        exit 1
    fi
done

echo ""
echo "‚úÖ Todos los archivos modificados cuentan con la documentaci√≥n necesaria."
echo "üéâ Validaci√≥n completada. Procediendo con el push."
exit 0
